<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>An Essentials Guide to PyTorch Dataset and DataLoader Usage | Dilip Thiagarajan</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="An Essentials Guide to PyTorch Dataset and DataLoader Usage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A brief guide for basic usage of PyTorch’s Dataset and DataLoader classes." />
<meta property="og:description" content="A brief guide for basic usage of PyTorch’s Dataset and DataLoader classes." />
<link rel="canonical" href="https://dthiagarajan.github.io/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html" />
<meta property="og:url" content="https://dthiagarajan.github.io/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html" />
<meta property="og:site_name" content="Dilip Thiagarajan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-09T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"A brief guide for basic usage of PyTorch’s Dataset and DataLoader classes.","headline":"An Essentials Guide to PyTorch Dataset and DataLoader Usage","@type":"BlogPosting","dateModified":"2020-03-09T00:00:00-05:00","datePublished":"2020-03-09T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dthiagarajan.github.io/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html"},"url":"https://dthiagarajan.github.io/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/technical_blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://dthiagarajan.github.io/technical_blog/feed.xml" title="Dilip Thiagarajan" /><link rel="shortcut icon" type="image/x-icon" href="/technical_blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>An Essentials Guide to PyTorch Dataset and DataLoader Usage | Dilip Thiagarajan</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="An Essentials Guide to PyTorch Dataset and DataLoader Usage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A brief guide for basic usage of PyTorch’s Dataset and DataLoader classes." />
<meta property="og:description" content="A brief guide for basic usage of PyTorch’s Dataset and DataLoader classes." />
<link rel="canonical" href="https://dthiagarajan.github.io/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html" />
<meta property="og:url" content="https://dthiagarajan.github.io/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html" />
<meta property="og:site_name" content="Dilip Thiagarajan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-09T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"A brief guide for basic usage of PyTorch’s Dataset and DataLoader classes.","headline":"An Essentials Guide to PyTorch Dataset and DataLoader Usage","@type":"BlogPosting","dateModified":"2020-03-09T00:00:00-05:00","datePublished":"2020-03-09T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dthiagarajan.github.io/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html"},"url":"https://dthiagarajan.github.io/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://dthiagarajan.github.io/technical_blog/feed.xml" title="Dilip Thiagarajan" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    // remove paragraph tags in rendered toc (happens from notebooks)
    var toctags = document.querySelectorAll(".toc-entry")
    toctags.forEach(e => (e.firstElementChild.innerText = e.firstElementChild.innerText.replace('¶', '')))
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/technical_blog/">Dilip Thiagarajan</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/technical_blog/about/">About Me</a><a class="page-link" href="/technical_blog/search/">Search</a><a class="page-link" href="/technical_blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">An Essentials Guide to PyTorch Dataset and DataLoader Usage</h1><p class="page-description">A brief guide for basic usage of PyTorch&#39;s Dataset and DataLoader classes.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-03-09T00:00:00-05:00" itemprop="datePublished">
        Mar 9, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/technical_blog/categories/#pytorch">pytorch</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/dthiagarajan/technical_blog/tree/master/_notebooks/2020-03-09-PyTorch-Dataset-and-DataLoaders.ipynb" role="button">
<img class="notebook-badge-image" src="/technical_blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div><div class="px-2">
    <a href="https://colab.research.google.com/github/dthiagarajan/technical_blog/blob/master/_notebooks/2020-03-09-PyTorch-Dataset-and-DataLoaders.ipynb">
        <img class="notebook-badge-image" src="/technical_blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Overview">Overview </a></li>
<li class="toc-entry toc-h2"><a href="#Setup">Setup </a></li>
<li class="toc-entry toc-h2"><a href="#Dataset-Class-and-Instantiation">Dataset Class and Instantiation </a></li>
<li class="toc-entry toc-h2"><a href="#Batching-via-the-DataLoader-class">Batching via the DataLoader class </a></li>
<li class="toc-entry toc-h2"><a href="#GPU-Usage">GPU Usage </a></li>
<li class="toc-entry toc-h2"><a href="#Afterword-and-Resources">Afterword and Resources </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-03-09-PyTorch-Dataset-and-DataLoaders.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview">
<a class="anchor" href="#Overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview<a class="anchor-link" href="#Overview"> </a>
</h2>
<p>In this short guide, we show a small representative example using the <code>Dataset</code> and <code>DataLoader</code> classes available in PyTorch for easy batching of training examples. This is more meant to be an onboarding for me with <code>fastpages</code>, but hopefully this example will be useful to those beginning to use PyTorch for their own applications.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">
<a class="anchor" href="#Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup<a class="anchor-link" href="#Setup"> </a>
</h2>
<p>The first thing we need is the essential import: <code>torch</code>, i.e. PyTorch. Make sure that when you're running a notebook with code similar to this that you've imported <code>torch</code>, i.e. <code>import torch</code>, as shown below.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_hide</span>
<span class="kn">import</span> <span class="nn">torch</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll then need a dataset to work with. For this small example, we'll use <code>numpy</code> to generate a random dataset for us. Specifically, we'll be working with a batch size of 32 later, so we'll create a dataset with exactly 50 batches, where each example has 5 features and a corresponding label between 0-9, inclusive. To do so, we use</p>
<ul>
<li>
<code>np.random.randn</code> for generating the input examples</li>
<li>
<code>np.random.randint</code> for generating the labels</li>
</ul>
<p>The exact code is shown below.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">training_examples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">training_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="o">*</span><span class="mi">50</span><span class="p">,))</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As a sanity check, let's look at the shapes. We'll want the size of the <em>whole</em> dataset to be (1600, 5), as we have $32*50$ examples, each with 5 features. Similarly, we'll want the size of the labels for the whole dataset to be (1600,), as we're essentially working with a list of 1600 labels.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">training_examples</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">training_labels</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((1600, 5), (1600,))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can look at some of the labels, just for a sanity check that they look reasonable.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">training_labels</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([8, 4, 3, 3, 9, 8, 1, 0, 5, 8])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dataset-Class-and-Instantiation">
<a class="anchor" href="#Dataset-Class-and-Instantiation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dataset Class and Instantiation<a class="anchor-link" href="#Dataset-Class-and-Instantiation"> </a>
</h2>
<p>Now, we'll create a simple PyTorch dataset class. All you need to implement within this class is the <code>__getitem__</code> function and the <code>__len__</code> function.</p>
<ul>
<li>
<code>__getitem__</code> is a function that takes in an index, and returns <code>dataset[index]</code>
</li>
<li>
<code>__len__</code> returns the size of your dataset (in this case, that's 32*50).</li>
</ul>
<p>When writing this class, you MUST subclass <code>torch.utils.data.Dataset</code>, as this is requirement for using the DataLoader class (see below).</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ExampleDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="sd">""" You can define the __init__ function any way you like"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">examples</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">examples</span> <span class="o">=</span> <span class="n">examples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>

    <span class="sd">""" This function signature always should take in 1 argument, corresponding to the index you're going to access.</span>
<span class="sd">        In this case, we're returning a tuple, corresponding to the training example and the corresponding label. </span>
<span class="sd">        </span>
<span class="sd">        It will also be useful to convert the returned values to torch.Tensors, so we can push the data onto the</span>
<span class="sd">        GPU later on. Note how the label is put into an array, but the example isn't. This is just a convention:</span>
<span class="sd">        if we don't put `self.labels[index]` in a list, it'll just create a tensor of zeros with `self.labels[index]` zeros.</span>
<span class="sd">        """</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]]))</span>

    <span class="sd">""" This function signature always should take in 0 arguments, and the output should be an `int`. """</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">examples</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we can instantiate an instance of our <code>ExampleDataset</code> class, which subclasses <code>torch.utils.data.Dataset</code>. Note that we can specify how to initialize this via the <code>__init__</code> function, which takes in a list of examples, and a list of labels (i.e. what we've instantiated in our own setup).</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">training_dataset</span> <span class="o">=</span> <span class="n">ExampleDataset</span><span class="p">(</span><span class="n">training_examples</span><span class="p">,</span> <span class="n">training_labels</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sanity check - see the correspondence between accessing the dataset instance of the class above and the examples/labels we passed in.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">training_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([ 0.4257,  0.0499,  0.2127,  0.8207, -1.1252]), tensor([8.]))</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">training_examples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">training_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(array([ 0.42565871,  0.04990118,  0.21268054,  0.82069534, -1.12520862]), 8)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can iterate over this dataset using standard for loop syntax as well. The way you write the for loop depends on how <code>__getitem__</code> is set up. In our case, we return a tuple (example and label), so the for loop should also have a tuple.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">training_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">example</span><span class="p">),</span> <span class="n">example</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">label</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class 'torch.Tensor'&gt; torch.Size([5]) &lt;class 'torch.Tensor'&gt; torch.Size([1])
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">training_dataset</span><span class="p">):</span>
    <span class="k">continue</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 1600/1600 [00:00&lt;00:00, 85500.98it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Batching-via-the-DataLoader-class">
<a class="anchor" href="#Batching-via-the-DataLoader-class" aria-hidden="true"><span class="octicon octicon-link"></span></a>Batching via the DataLoader class<a class="anchor-link" href="#Batching-via-the-DataLoader-class"> </a>
</h2>
<p>To set up batching, we'll use the <code>torch.utils.data.DataLoader</code> class. All we have to do to create this DataLoader is to instantiate it with our dataset we created above (<code>training_dataset</code>). The arguments for <code>torch.utils.data.DataLoader</code> are worth looking at, but (generally) most important are:</p>
<ul>
<li>
<code>dataset</code>: the PyTorch dataset class instance we'll pass in (e.g. <code>training_dataset</code>, this is why we had to do subclassing above)</li>
<li>
<code>batch_size</code> (optional, default is 1): the batch size we want when iterating (we'll pass in 32)</li>
<li>
<code>shuffle</code> (optional, default is <code>False</code>): whether we want to shuffle when iterating once the dataloader (note that if this is set to true, it'll shuffle every epoch; note also that we only really want to have this set to true for training, not necessarily for validation)</li>
<li>
<code>drop_last</code> (optional, default is <code>False</code>): whether to drop the last incomplete batch (we don't have to worry about this because the number of training examples is exactly divisible by 32)</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">training_dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">training_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Again, we can iterate, just like we did for <code>training_dataset</code>, but now, we get batches back, as we can see by printing the shapes. The magic happens in the <code>collate_fn</code> optional argument of the DataLoader class, but the default behavior is sufficient here for batching the examples and labels separately.</p>
<p>We'll first ensure that there are exactly 50 batches in our dataloader to work with.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">training_dataloader</span><span class="p">)</span> <span class="o">==</span> <span class="mi">50</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, mimicking the iteration from above, with the <code>ExampleDataset</code> instance:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">training_dataloader</span><span class="p">):</span>
    <span class="k">continue</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50/50 [00:00&lt;00:00, 2255.73it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At some point, you may want to know information about a specific batch - accessing specific batches from the DataLoader is not as easy - I don't know of a way to grab a specific batch, other than doing something like the following.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">training_dataloader_batches</span> <span class="o">=</span> <span class="p">[(</span><span class="n">example</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">training_dataloader</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">some_example</span><span class="p">,</span> <span class="n">some_label</span> <span class="o">=</span> <span class="n">training_dataloader_batches</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
<span class="n">some_example</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">some_label</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([32, 5]), torch.Size([32, 1]))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, you can always access the underlying dataset by literally doing <code>.dataset</code>, as shown below.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">training_dataloader</span><span class="o">.</span><span class="n">dataset</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;__main__.ExampleDataset at 0x7f2f03857510&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">training_dataloader</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([ 0.0763, -0.3285, -1.0820,  0.2322, -0.2848]), tensor([8.]))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="GPU-Usage">
<a class="anchor" href="#GPU-Usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>GPU Usage<a class="anchor-link" href="#GPU-Usage"> </a>
</h2>
<p>Using the GPU is also trivial, even with the batches from the dataloader. Ensure that you have the GPU runtime set first, then run the following. You can verify that GPU is available with the condition shown below before the loop.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Using GPU."</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Using GPU.
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">training_dataloader</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">example</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">cuda</span><span class="p">(),</span> <span class="n">label</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50/50 [00:03&lt;00:00, 15.79it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Afterword-and-Resources">
<a class="anchor" href="#Afterword-and-Resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Afterword and Resources<a class="anchor-link" href="#Afterword-and-Resources"> </a>
</h2>
<p>As mentioned above, it's useful to look at the <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader">documentation</a> for <code>torch.utils.data.DataLoader</code>. Another way to do so within the notebook itself is to run the following within a cell of the notebook:</p>

<pre><code>torch.utils.data.DataLoader?</code></pre>
<p>There are many interesting things that you can do here, with the arguments allowed in the DataLoader. For example:</p>
<ul>
<li>You may be working with an image dataset large enough that you don't want to open all the images (e.g. using <code>PIL</code>) before feeding them through your model. In that case, you can lazily open them by passing in a <code>collate_fn</code> that opens the images before collating the examples of a batch, since <code>collate_fn</code> is only called for each iteration when iterating over the DataLoader, and not when the DataLoader is instantiated.</li>
<li>You may not want to <code>shuffle</code> the dataset, as it might incur unnecessary computation. This is especially true if you have a separate DataLoader for your validation dataset, in which case there's no need to shuffle, as it won't affect the predictions.</li>
<li>If you have access to multiple CPUs on whatever machine you're working on, you can use <code>num_workers</code> to load batches ahead of time on the other CPUs, i.e. the other workers.</li>
<li>If you're working with a GPU, one of the more expensive steps in the pipeline is moving data from CPU to GPU - this can be sped up by using <code>pin_memory</code>, which ensures that the same space in the GPU RAM is used for the data being transferred from the CPU.</li>
</ul>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="dthiagarajan/technical_blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/technical_blog/pytorch/2020/03/09/PyTorch-Dataset-and-DataLoaders.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/technical_blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/technical_blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/technical_blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Technical blog written by Dilip Thiagarajan.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/dthiagarajan" title="dthiagarajan"><svg class="svg-icon grey"><use xlink:href="/technical_blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/iamdilio" title="iamdilio"><svg class="svg-icon grey"><use xlink:href="/technical_blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
